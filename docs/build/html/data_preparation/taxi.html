<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Taxi &mdash; GTgen 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bitcoin" href="bitcoin.html" />
    <link rel="prev" title="Mawi" href="mawi.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            GTgen
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmark/index.html">Benchmark</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Data Preparation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mawi.html">Mawi</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Taxi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#plots">Plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-preparation">Data Preparation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bitcoin.html">Bitcoin</a></li>
<li class="toctree-l2"><a class="reference internal" href="peru.html">Peru</a></li>
<li class="toctree-l2"><a class="reference internal" href="prepare_data.html">Prepare Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../random_generation/index.html">Random Graph and Timeserie Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../link_stream_generation/index.html">Link Stream Generation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GTgen</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Data Preparation</a></li>
      <li class="breadcrumb-item active">Taxi</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/data_preparation/taxi.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="taxi">
<span id="id1"></span><h1>Taxi<a class="headerlink" href="#taxi" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p>The dataset consists of <cite>165,114,362 trip records</cite> over the year 2014. A record includes various fields capturing trip characteristics such as pick-up and drop-off GPS locations and dates, trip durations and distances, fares, payment methods, or driver-reported passenger counts.</p></li>
</ul>
<section id="plots">
<h2>Plots<a class="headerlink" href="#plots" title="Permalink to this heading"></a></h2>
<figure class="align-left" id="id2">
<a class="reference internal image-reference" href="../_images/taxi_stream.txt.degree.png"><img alt="../_images/taxi_stream.txt.degree.png" src="../_images/taxi_stream.txt.degree.png" style="width: 320.0px; height: 240.0px;" /></a>
<figcaption>
<p><span class="caption-text">The degree distribution of the taxi dataset</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-right" id="id3">
<a class="reference internal image-reference" href="../_images/taxi_stream.txt.weight.png"><img alt="../_images/taxi_stream.txt.weight.png" src="../_images/taxi_stream.txt.weight.png" style="width: 320.0px; height: 240.0px;" /></a>
<figcaption>
<p><span class="caption-text">The weight distribution of the taxi dataset</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../_images/taxi_stream.txt.ts.png"><img alt="../_images/taxi_stream.txt.ts.png" src="../_images/taxi_stream.txt.ts.png" style="width: 320.0px; height: 240.0px;" /></a>
<figcaption>
<p><span class="caption-text">The timeserie of the taxi dataset</span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="data-preparation">
<h2>Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>For our purpose, we only retain, for each trip, the pick-up and drop-off locations as well as starting and ending timestamps. In order to parse this list of records into a proper stream, we use a grid to map each location into a grid identifier (i.e. the coordinates of the grid’s rectangle containing the location point). In this way, we can parse each trip into a <cite>(t_0,t_1,u,v)</cite> quadruplet where <cite>u</cite> (resp. <cite>v</cite>) is the grid identifier of the trip’s pick-up (resp. drop-off) location. In other words, the nodes of the resulting stream are locations (expressed in grid coordinates) and links represent taxi trips between the endpoint’s locations.</p></li>
<li><p>This approach has the advantage of enabling us to decide how many nodes are involved in the stream by tunning the grid’s resolution. Note however that because we do not consider self-links (i.e. links starting and ending within the same grid’s cell), the number of links in the stream depends on the grid’s resolutions. For example, after parsing the dataset with a :math: <cite>1000 times 1000</cite> grid, we obtain a stream of <cite>10^6</cite> nodes and <cite>153,271,442</cite> trips. The code to download and parse the data into a proper stream of trips is available on <a class="reference external" href="https://github.com/NicolasGensollen/nyc_taxi_stream">GitHub</a>.</p></li>
<li><p>In practice, after defining the grid <cite>nyc</cite> and reading the csv using pandas, we use the following:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Both the pickup location and the dropoff location have to be within the limits</span>
<span class="k">if</span> <span class="p">((</span><span class="n">nyc</span><span class="o">.</span><span class="n">is_inside</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;pickup_longitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;pickup_latitude&quot;</span><span class="p">]))</span> <span class="ow">and</span>
    <span class="p">(</span><span class="n">nyc</span><span class="o">.</span><span class="n">is_inside</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;dropoff_longitude&quot;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;dropoff_latitude&quot;</span><span class="p">]))):</span>

    <span class="c1"># Cast times to Unix timestamps</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">to_datetime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;pickup_datetime&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">to_datetime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;dropoff_datetime&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
    <span class="n">thalf</span> <span class="o">=</span> <span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">t1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

    <span class="k">if</span> <span class="n">t0</span> <span class="o">&lt;</span> <span class="n">t1</span> <span class="ow">and</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span> <span class="o">&gt;=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tminus</span> <span class="o">&lt;=</span> <span class="n">t0</span> <span class="o">&lt;=</span> <span class="n">tplus</span> <span class="ow">and</span> <span class="n">tminus</span> <span class="o">&lt;=</span> <span class="n">t1</span> <span class="o">&lt;=</span> <span class="n">tplus</span><span class="p">:</span>

            <span class="c1"># Get the bounding boxes in the grid</span>
            <span class="n">ux</span><span class="p">,</span><span class="n">uy</span> <span class="o">=</span> <span class="n">nyc</span><span class="o">.</span><span class="n">get_box_idx2</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;pickup_longitude&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;pickup_latitude&quot;</span><span class="p">])</span>
            <span class="n">vx</span><span class="p">,</span><span class="n">vy</span> <span class="o">=</span> <span class="n">nyc</span><span class="o">.</span><span class="n">get_box_idx2</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;dropoff_longitude&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;dropoff_latitude&quot;</span><span class="p">])</span>
            <span class="c1"># We don&#39;t want self-links, so we only keep trips going from one bbox to another</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ux</span><span class="p">,</span><span class="n">uy</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">):</span>

                <span class="c1"># Build the interaction as a string</span>
                <span class="k">if</span> <span class="n">simplify</span><span class="p">:</span>
                    <span class="n">interaction</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">thalf</span><span class="si">}</span><span class="s2"> &lt;</span><span class="si">{</span><span class="n">ux</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">uy</span><span class="si">}</span><span class="s2">&gt; &lt;</span><span class="si">{</span><span class="n">vx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">vy</span><span class="si">}</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">interaction</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t0</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">t1</span><span class="si">}</span><span class="s2"> &lt;</span><span class="si">{</span><span class="n">ux</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">uy</span><span class="si">}</span><span class="s2">&gt; &lt;</span><span class="si">{</span><span class="n">vx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">vy</span><span class="si">}</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">taxi_stream</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interaction</span><span class="p">)</span>

                <span class="c1"># Empty the buffer every 10**6 interactions...</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">taxi_stream</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">interaction</span> <span class="ow">in</span> <span class="n">taxi_stream</span><span class="p">:</span>
                            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">interaction</span><span class="p">)</span>
                    <span class="n">taxi_stream</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mawi.html" class="btn btn-neutral float-left" title="Mawi" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="bitcoin.html" class="btn btn-neutral float-right" title="Bitcoin" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, ComplexNetworks.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>